# HitOrMiss - ML and Backend

## DESCRIPTION:
This part of the application is responsible for the Machine Learning and backend for predicting the Hit percentage for a sing. 
The final outcome of this repository is an API that can be used for making country-wise hit probability prediction. 

File description and responsibilities of each component: 
- ```model_experiment.ipynb```: Finalises the features used for training
- ```mlmodel.py```: Trains the model and save the weights for each country, while saving the country-wise accuracy generated by each model in the file ```country_wise_accuracy.csv```.
-  ```accuracy.ipynb```: Determines and visualises the overall average accuracy of each of the models.
-  ```app.py```: Calculates weighted average probability prediction (top three models) of the song whose features are provided, by exposing a POST API.

## INSTALLATION:
- Python version requirement >= 3.9, and Jupyter notebook support for .ipynb files.
- (Optional but recommended) Create a Virtual Environment: ```python3 -m venv <name_of_venv>```. Activate virtual environment: Windows: ```venv\Scripts\activate.bat```, MacOS/Linux: ```source venv\bin\activate``` . To deactivate after execution: Windows: ```venv\Scripts\deactivate.bat```, MacOS/Linux: ```source venv\bin\deactivate```
- ```pip3 install -r requirements.txt```: to install all the necessary requirements.
- (Optional) Run the notebook ```model_experiment.ipynb``` to find out the final features that can be used which are "acousticness", "danceability", "duration_ms", "energy", "instrumentalness", "liveness", "loudness", "speechiness", "tempo", "valence".
- Run ```mlmodel.py``` from the terminal: ```python3 mlmodel.py``` which generates the models in model folder.
- (Optional) Run the notebook ```accuracy.ipynb``` to find out the final model accuracy averaged by all 73 countries.


## EXECUTION:
- Run the file ```app.py``` from the terminal: ```python3 app.py``` to make the local instance up : ```http://127.0.0.1:5000```. Cross-verify the PORT, and replace if necessary.
- Hit the API using cURL or Postman: curl --location --request POST 'http://127.0.0.1:5000/predict' \
--header 'Content-Type: application/json' \
--data-raw '{
    "acousticness": 0.163, 
    "danceability" : 0.793, 
    "duration_ms": 165888, 
    "energy": 0.75, 
    "instrumentalness": 0.0, 
    "liveness": 0.127, 
    "loudness": -6.1,
    "speechiness": 0.051, 
    "tempo": 125.001, 
    "valence": 0.731
}'

## DEPLOYMENT:
This project has been deployed using an Azure App Service B3 SKU. The B3 instance has a 7GB RAM, 10GB storage and 4 cores, and costs around $0.07/hour. We used the following steps to deploy the application:

- Creating an Azure App Service using the GUI
  - Choose the "code" option for the Publish option
  - Choose Python >= 3.9 for the runtime stack
  - Choose "Linux" for the Operating System
  - Choose the closest region (We use US East)
  - Choose the "B3" pricing plan (This project can be run on a B1 instance as well)
  - [Optional] Configure deployment, networking, monitoring and tags if needed
  - Review and Create
- Deploying the application using the Azure VSCode extension
  - Login using Azure credentials
  - Select project in Azure App Services
  - Right-click on the project and click on "Deploy to Web App"

Alternatively, the project can also be deployed using the Azure CLI
```
az login
az webapp up --os linux --runtime PYTHON:3.9 --sku B3 --name <app-name> --location <location-name>
```

## NOTE
This API is also hosted on Microsoft Azure with the endpoint: ```POST https://hit-or-miss.azurewebsites.net/predict```

